Go-RedisOrm
ฺฉ ORM (Object-Relational Mapper) ุณุงุฏูุ ุณุฑุน ู ุงูู ุจุฑุง ุฒุจุงู Go ฺฉู ุจุฑุง ฺฉุงุฑ ุจุง Redis ุทุฑุงุญ ุดุฏู ุงุณุช. ุงู ฺฉุชุงุจุฎุงูู ุจู ุดูุง ุงุฌุงุฒู ูโุฏูุฏ ุชุง ุจุง structูุง Go ุจู ุฑุงุญุช ฺฉุงุฑ ฺฉูุฏ ู ูพฺุฏฺฏโูุง ูุฑุจูุท ุจู ุณุฑุงูุงุฒ ฺฉุฑุฏูุ ุงูุฏฺฉุณโฺฏุฐุงุฑ ู ุฑูุฒูฺฏุงุฑ ุฑุง ูุฏุฑุช ูโฺฉูุฏ.

โจ ูฺฺฏโูุง
ูุฏูโุณุงุฒ ูุจุชู ุจุฑ Struct: ูุฏูโูุง ุฎูุฏ ุฑุง ุจุง ุงุณุชูุงุฏู ุงุฒ ุชฺฏโูุง struct ุชุนุฑู ฺฉูุฏ.

ูุฏุฑุช ุฎูุฏฺฉุงุฑ ููุฏูุง: ุชููุฏ ุฎูุฏฺฉุงุฑ ฺฉูุฏ ุงุตู (UUID) ู ุจูโุฑูุฒุฑุณุงู ุฎูุฏฺฉุงุฑ ููุฏูุง CreatedAt ู UpdatedAt.

ุงูุฏฺฉุณโฺฏุฐุงุฑ ูุฏุฑุชููุฏ: ูพุดุชุจุงู ุงุฒ ุงูุฏฺฉุณโูุง ูุนููู (index)ุ ููฺฉ (unique) ู ุฑูุฒูฺฏุงุฑโุดุฏู (index_enc) ุจุฑุง ุฌุณุชุฌู ุณุฑุน.

ุฑูุฒูฺฏุงุฑ ุณูุช ฺฉูุงูุช: ููุฏูุง ุญุณุงุณ ุฑุง ุจุง ุชฺฏ secret:"true" ูุดุฎุต ฺฉูุฏ ุชุง ุจู ุตูุฑุช ุฎูุฏฺฉุงุฑ ุจุง ุงูฺฏูุฑุชู AES-GCM ู ุจุง ุงุณุชูุงุฏู ุงุฒ ฺฉูุฏ ุงุตู ุดูุง ุฑูุฒูฺฏุงุฑ ุดููุฏ.

ุนููุงุช ุงุชู: ุชูุงู ุนููุงุช ููุดุชูุ ุขูพุฏุช ู ุญุฐู ุจุง ุงุณุชูุงุฏู ุงุฒ ุงุณฺฉุฑูพุชโูุง Lua ุงูุฌุงู ูโุดูุฏ ุชุง ุงุฒ ุณุงุฒฺฏุงุฑ ุฏุงุฏูโูุง ุงุทููุงู ุญุงุตู ุดูุฏ.

ููู ุฎูุดโุจูุงูู (Optimistic Locking): ุจุง ุงูุฒูุฏู ููุฏ Version ุจู ูุฏูโูุง ุฎูุฏุ ุงุฒ ุชุฏุงุฎู ุฏุฑ ููุดุชูโูุง ููุฒูุงู ุฌููฺฏุฑ ฺฉูุฏ.

ุขูพุฏุชโูุง ุณุฑุน ู ุฌุฒุฆ: ุจุง ุงุณุชูุงุฏู ุงุฒ UpdateFieldsFastุ ููุฏูุง ุบุฑ ุงูุฏฺฉุณ ุฑุง ุจุง ุณุฑุนุช ุจุณุงุฑ ุจุงูุง ู ุจุฏูู ูุงุฒ ุจู ุฎูุงูุฏู ฺฉู ุดุกุ ุจูโุฑูุฒุฑุณุงู ฺฉูุฏ.

ุฐุฎุฑูโุณุงุฒ Payload: ุฏุงุฏูโูุง ุญุฌู ุง ุณุงุฎุชุงุฑูุง JSON ุงุถุงู ุฑุง ุจู ุตูุฑุช ุฌุฏุงฺฏุงูู ุจู ฺฉ ุดุก ุงุตู ูุชุตู ฺฉูุฏ.

๐ ูุตุจ
go get github.com/mrjvadi/Go-RedisOrm

quick-start-fa ุดุฑูุน ุณุฑุน
ุฏุฑ ุงุฏุงูู ฺฉ ูุซุงู ฺฉุงูู ุจุฑุง ุชุนุฑู ูุฏูุ ุฐุฎุฑูุ ุฎูุงูุฏู ู ุขูพุฏุช ฺฉ ุดุก ุขูุฑุฏู ุดุฏู ุงุณุช.

package main

import (
	"context"
	"fmt"
	"log"
	"time"

	"github.com/mrjvadi/Go-RedisOrm/redisorm"
	"github.com/redis/go-redis/v9"
)

// 1. ูุฏู ุฎูุฏ ุฑุง ุชุนุฑู ฺฉูุฏ
type User struct {
	ID        string    `json:"id" redis:"pk" default:"uuid"`
	Version   int64     `json:"version" redis:"version"`
	Email     string    `json:"email" secret:"true" redis:",unique"`
	Country   string    `json:"country" redis:",index"`
	Status    string    `json:"status"`
	CreatedAt time.Time `json:"created_at" default:"now"`
	UpdatedAt time.Time `json:"updated_at"`
}

func main() {
	ctx := context.Background()

	// 2. ุจู Redis ูุชุตู ุดูุฏ
	rdb := redis.NewClient(&redis.Options{Addr: "localhost:6379"})
	
	// 3. ฺฉ ููููู ุงุฒ ORM ุจุณุงุฒุฏ
	// ฺฉ ฺฉูุฏ ุฑูุฒูฺฏุงุฑ ุงูู (16ุ 24 ุง 32 ุจุงุช) ุงุฑุงุฆู ุฏูุฏ
	orm, err := redisorm.New(rdb, 
		redisorm.WithNamespace("myapp"), 
		redisorm.WithMasterKey([]byte("my-super-secret-32-byte-key-!!")),
	)
	if err != nil {
		log.Fatalf("failed to create orm: %v", err)
	}

	// 4. ฺฉ Session ุจุฑุง ุงูุฌุงู ุนููุงุช ุงุฌุงุฏ ฺฉูุฏ
	sess := orm.WithContext(ctx)

	// 5. ฺฉ ฺฉุงุฑุจุฑ ุฌุฏุฏ ุฐุฎุฑู ฺฉูุฏ
	user := &User{Email: "user@example.com", Country: "IR", Status: "active"}
	id, err := sess.Save(user)
	if err != nil {
		log.Fatalf("failed to save user: %v", err)
	}
	fmt.Printf("ฺฉุงุฑุจุฑ ุจุง ุดูุงุณู %s ุฐุฎุฑู ุดุฏ.\n", id)

	// 6. ฺฉุงุฑุจุฑ ุฑุง ุจุฎูุงูุฏ
	var loadedUser User
	if err := sess.Load(&loadedUser, id); err != nil {
		log.Fatalf("failed to load user: %v", err)
	}
	fmt.Printf("ุงูู ฺฉุงุฑุจุฑ ุฎูุงูุฏู ุดุฏู: %s (ฺฉุดูุฑ: %s)\n", loadedUser.Email, loadedUser.Country)

	// 7. ฺฉ ููุฏ ุฑุง ุจู ุณุฑุนุช ุขูพุฏุช ฺฉูุฏ (ุจุฏูู ุชุบุฑ ุงูุฏฺฉุณ)
	updates := map[string]any{"status": "inactive"}
	if err := sess.UpdateFieldsFast(&User{}, id, updates); err != nil {
		log.Fatalf("failed to fast update user: %v", err)
	}
	fmt.Println("ูุถุนุช ฺฉุงุฑุจุฑ ุจุง ููููุช ุจู 'inactive' ุชุบุฑ ฺฉุฑุฏ.")

	// 8. ฺฉุงุฑุจุฑ ุฑุง ุญุฐู ฺฉูุฏ
	if err := sess.Delete(&User{}, id); err != nil {
		log.Fatalf("failed to delete user: %v", err)
	}
	fmt.Println("ฺฉุงุฑุจุฑ ุจุง ููููุช ุญุฐู ุดุฏ.")
}

๐ ุฑุงูููุง ุงุณุชูุงุฏู
ุชุนุฑู ูุฏู
ุงุฒ ุชฺฏโูุง struct ุจุฑุง ุชุนุฑู ุฑูุชุงุฑ ORM ุงุณุชูุงุฏู ฺฉูุฏ:

redis:"pk": ุงู ููุฏ ุฑุง ุจู ุนููุงู ฺฉูุฏ ุงุตู (ุงุฒ ููุน string) ูุดุฎุต ูโฺฉูุฏ.

redis:"version": ุงู ููุฏ ุฑุง ุจุฑุง ููู ุฎูุดโุจูุงูู (ุงุฒ ููุน int64) ูุนุงู ูโฺฉูุฏ.

redis:",index": ฺฉ ุงูุฏฺฉุณ ูุนููู ุฑู ุงู ููุฏ ุงุฌุงุฏ ูโฺฉูุฏ.

redis:",index_enc": ฺฉ ุงูุฏฺฉุณ ุฑูุฒูฺฏุงุฑโุดุฏู (ูุงุจู ุฌุณุชุฌู) ุฑู ุงู ููุฏ ุงุฌุงุฏ ูโฺฉูุฏ.

redis:",unique": ฺฉ ูุญุฏูุฏุช ฺฉุชุง ุจูุฏู ุฑู ุงู ููุฏ ุงุนูุงู ูโฺฉูุฏ.

secret:"true": ููุฏุงุฑ ุงู ููุฏ (ุงุฒ ููุน string) ุฑุง ูุจู ุงุฒ ุฐุฎุฑูโุณุงุฒ ุฑูุฒูฺฏุงุฑ ูโฺฉูุฏ.

default:"...": ฺฉ ููุฏุงุฑ ูพุดโูุฑุถ ุจุฑุง ููุฏ ุฏุฑ ุฒูุงู ุงุฌุงุฏ ุชุนู ูโฺฉูุฏ (ูุซูุงู uuid, now).

ุขูพุฏุช ุณุฑุน ุฏุฑ ููุงุจู ุขูพุฏุช ฺฉุงูู
UpdateFields(user, id, updates): ฺฉูุฏุชุฑ ุงูุง ุงูู. ุงุจุชุฏุง ุดุก ุฑุง ูโุฎูุงูุฏุ ุชุบุฑุงุช ุฑุง ุงุนูุงู ูโฺฉูุฏ ู ุณูพุณ ุขู ุฑุง ุฏูุจุงุฑู ุฐุฎุฑู ูโฺฉูุฏ. ุงูุฏฺฉุณโูุง ุฑุง ูุฒ ุจูโุฑูุฒุฑุณุงู ูโฺฉูุฏ.

UpdateFieldsFast(User{}, id, updates): ุจุณุงุฑ ุณุฑุน. ูุณุชููุงู JSON ุฐุฎุฑู ุดุฏู ุฏุฑ Redis ุฑุง ุขูพุฏุช ูโฺฉูุฏ. ุงูุฏฺฉุณโูุง ุฑุง ุขูพุฏุช ููโฺฉูุฏ. ุงุฒ ุงู ุชุงุจุน ููุท ุจุฑุง ููุฏูุง ุงุณุชูุงุฏู ฺฉูุฏ ฺฉู ุงูุฏฺฉุณ ูุดุฏูโุงูุฏ.

ุฌุณุชุฌู ุจุง ุงูุฏฺฉุณ
ุงุฒ ุชูุงุจุน PageIDs... ุจุฑุง ุฌุณุชุฌู ู ุตูุญูโุจูุฏ ูุชุงุฌ ุงุณุชูุงุฏู ฺฉูุฏ.

// ุฌุณุชุฌู ุจุฑ ุงุณุงุณ ููุฏ ุงูุฏฺฉุณโุดุฏู 'Country'
ids, nextCursor, err := sess.PageIDsByIndex(&User{}, "Country", "IR", 0, 50)

// ุฌุณุชุฌู ุจุฑ ุงุณุงุณ ููุฏ ุฑูุฒูฺฏุงุฑโุดุฏู 'Email'
ids, nextCursor, err := sess.PageIDsByEncIndex(&User{}, "Email", "user@example.com", 0, 50)

๐ ูุฌูุฒ
ุงู ูพุฑูฺู ุชุญุช ูุฌูุฒ MIT ููุชุดุฑ ุดุฏู ุงุณุช.